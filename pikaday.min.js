/*!
 * Pikaday
 * Copyright Â© 2012 David Bushell | BSD & MIT license | http://dbushell.com/
 */
(function(e,t,n){"use strict";var r=typeof e.moment=="function",i=!!e.addEventListener,s=function(e,t,n,r){i?e.addEventListener(t,n,!!r):e.attachEvent("on"+t,n)},o=function(e,t,n,r){i?e.removeEventListener(t,n,!!r):e.detachEvent("on"+t,n)},u=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},a=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")!==-1},f=function(e,t){a(e,t)||(e.className=e.className===""?t:e.className+" "+t)},l=function(e,t){var n=" "+e.className+" ";e.className=u((" "+e.className+" ").replace(" "+t+" "," "))},c=function(e){return/Array/.test(Object.prototype.toString.call(e))},h=function(e){return/Date/.test(Object.prototype.toString.call(e))&&!isNaN(e.getTime())},p=function(e){return e%4===0&&e%100!==0||e%400===0},d=function(e,t){return[31,p(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},v=function(e,t){return e.getTime()===t.getTime()},m=function(e,t,r){var i,s;for(i in t){s=e[i]!==n;if(s&&typeof t[i]=="object"&&t[i].nodeName===n)h(t[i])?r&&(e[i]=new Date(t[i].getTime())):c(t[i])?r&&(e[i]=t[i].slice(0)):e[i]=m({},t[i],r);else if(r||!s)e[i]=t[i]}return e},g={field:null,bound:n,format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:!1,firstDay:0,minDate:null,maxDate:null,yearRange:10,minYear:0,maxYear:9999,minMonth:n,maxMonth:n,isRTL:!1,numberOfMonths:1,i18n:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},onSelect:null,onOpen:null,onClose:null},y=function(e,t,n){t+=e.firstDay;while(t>=7)t-=7;return n?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]},b=function(e,t,n,r,i){if(i)return'<td class="is-empty"></td>';var s=[];return r&&s.push("is-disabled"),n&&s.push("is-today"),t&&s.push("is-selected"),'<td data-day="'+e+'" class="'+s.join(" ")+'"><button class="pika-button" type="button">'+e+"</button>"+"</td>"},w=function(e,t){return"<tr>"+(t?e.reverse():e).join("")+"</tr>"},E=function(e){return"<tbody>"+e.join("")+"</tbody>"},S=function(e){var t,n="<thead>",r=[];for(t=0;t<7;t++)r.push('<th scope="col"><abbr title="'+y(e,t)+'">'+y(e,t,!0)+"</abbr></th>");return n+=(e.isRTL?r.reverse():r).join(""),n+="</thead>"},x=function(e){var t,n,r,i=e._o,s=e._m,o=e._y,u=o===i.minYear,a=o===i.maxYear,f='<div class="pika-title">',l=!0,h=!0;for(r=[],t=0;t<12;t++)r.push('<option value="'+t+'"'+(t===s?" selected":"")+(u&&t<i.minMonth||a&&t>i.maxMonth?"disabled":"")+">"+i.i18n.months[t]+"</option>");f+='<div class="pika-label">'+i.i18n.months[s]+'<select class="pika-select pika-select-month">'+r.join("")+"</select></div>",c(i.yearRange)?(t=i.yearRange[0],n=i.yearRange[1]+1):(t=o-i.yearRange,n=1+o+i.yearRange);for(r=[];t<n&&t<=i.maxYear;t++)t>=i.minYear&&r.push('<option value="'+t+'"'+(t===o?" selected":"")+">"+t+"</option>");return f+='<div class="pika-label">'+o+'<select class="pika-select pika-select-year">'+r.join("")+"</select></div>",u&&(s===0||i.minMonth>=s)&&(l=!1),a&&(s===11||i.maxMonth<=s)&&(h=!1),f+='<button class="pika-prev'+(l?"":" is-disabled")+'" type="button">Previous Month</button>',f+='<button class="pika-next'+(h?"":" is-disabled")+'" type="button">Next Month</button>',f+="</div>"},T=function(e,t){return'<table class="pika-table">'+S(e)+E(t)+"</table>"};e.Pikaday=function(e){var n=this,r=n.config(e);n._onMouseDown=function(e){if(!n._v)return;var t=e.target;if(!a(t,"is-disabled")){if(a(t,"pika-button")&&!a(t,"is-empty")){n.setDate(new Date(n._y,n._m,parseInt(t.innerHTML,10))),r.bound&&setTimeout(function(){n.hide()},100);return}a(t,"pika-prev")?n.prevMonth():a(t,"pika-next")&&n.nextMonth()}if(!a(t,"pika-select")){if(!e.preventDefault)return e.returnValue=!1;e.preventDefault()}else n._c=!0},n._onChange=function(e){a(e.target,"pika-select-month")?n.gotoMonth(parseInt(e.target.value,10)):a(e.target,"pika-select-year")&&n.gotoYear(parseInt(e.target.value,10))},n._onInputChange=function(e){var t=new Date(Date.parse(r.field.value));n.setDate(h(t)?t:null),n._v||n.show()},n._onInputFocus=function(e){n._v||(n.gotoDate(),n.show())},n._onInputClick=function(e){n._onInputFocus()},n._onInputBlur=function(e){n._c||(n._b=setTimeout(function(){n.hide()},50)),n._c=!1},n._onClick=function(e){var t=e.target;do if(a(t,"pika-single"))return;while(t=t.parentNode);n._v&&e.target!==r.field&&n.hide()},n.el=t.createElement("div"),n.el.className="pika-single"+(r.isRTL?" is-rtl":""),s(n.el,"mousedown",n._onMouseDown,!0),s(n.el,"change",n._onChange),r.field&&(r.bound?t.body.appendChild(n.el):r.field.parentNode.insertBefore(n.el,r.field.nextSibling),s(r.field,"change",n._onInputChange),r.defaultDate||(r.defaultDate=new Date(Date.parse(r.field.value)),r.setDefaultDate=!0));var i=r.defaultDate;h(i)?r.setDefaultDate?n.setDate(i):n.gotoDate(i):n.gotoDate(new Date),r.bound?(this.hide(),n.el.className+=" is-bound",s(r.field,"click",n._onInputClick),s(r.field,"focus",n._onInputFocus),s(r.field,"blur",n._onInputBlur)):this.show()},e.Pikaday.prototype={config:function(e){this._o||(this._o=m({},g,!0));var t=m(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&&t.field.nodeName?t.field:null,t.bound=!!(t.bound!==n?t.field&&t.bound:t.field);var r=parseInt(t.numberOfMonths,10)||1;t.numberOfMonths=r>4?4:r,h(t.minDate)||(t.minDate=!1),h(t.maxDate)||(t.maxDate=!1),t.minDate&&t.maxDate&&t.maxDate<t.minDate&&(t.maxDate=t.minDate=!1),t.minDate&&(t.minYear=t.minDate.getFullYear(),t.minMonth=t.minDate.getMonth()),t.maxDate&&(t.maxYear=t.maxDate.getFullYear(),t.maxMonth=t.maxDate.getMonth());if(c(t.yearRange)){var i=(new Date).getFullYear()-10;t.yearRange[0]=parseInt(t.yearRange[0],10)||i,t.yearRange[1]=parseInt(t.yearRange[1],10)||i}else t.yearRange=Math.abs(parseInt(t.yearRange,10))||g.yearRange,t.yearRange>100&&(t.yearRange=100);return t},toString:function(t){return h(this._d)?r?e.moment(this._d).format(t||this._o.format):this._d.toDateString():""},getMoment:function(){return r?e.moment(this._d):null},getDate:function(){return h(this._d)?new Date(this._d.getTime()):null},setDate:function(e){if(!e)return this._d=null,this.draw();typeof e=="string"&&(e=new Date(Date.parse(e)));if(!h(e))return;var t=this._o.minDate,n=this._o.maxDate;h(t)&&e<t?e=t:h(n)&&e>n&&(e=n),this._d=new Date(e.getTime()),this._d.setHours(0,0,0,0),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString()),typeof this._o.onSelect=="function"&&this._o.onSelect.call(this,this.getDate())},gotoDate:function(e){if(!h(e))return;this._y=e.getFullYear(),this._m=e.getMonth(),this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e)||(this._m=parseInt(e<0?0:e>11?11:e,10),this.draw())},nextMonth:function(){++this._m>11&&(this._m=0,this._y++),this.draw()},prevMonth:function(){--this._m<0&&(this._m=11,this._y--),this.draw()},gotoYear:function(e){isNaN(e)||(this._y=parseInt(e,10),this.draw())},draw:function(e){if(!this._v&&!e)return;var t=this._o,n=t.minYear,r=t.maxYear,i=t.minMonth,s=t.maxMonth;this._y<=n&&(this._y=n,!isNaN(i)&&this._m<i&&(this._m=i)),this._y>=r&&(this._y=r,!isNaN(s)&&this._m>s&&(this._m=s)),this.el.innerHTML=x(this)+this.render(this._y,this._m);if(t.bound){var o=t.field,u=o.offsetLeft,a=o.offsetTop+o.offsetHeight;while(o=o.offsetParent)u+=o.offsetLeft,a+=o.offsetTop;this.el.style.cssText="position:absolute;left:"+u+"px;top:"+a+"px;",setTimeout(function(){t.field.focus()},1)}},render:function(e,t){var n=this._o,r=new Date,i=d(e,t),s=(new Date(e,t,1)).getDay(),o=[],u=[];r.setHours(0,0,0,0),n.firstDay>0&&(s-=n.firstDay,s<0&&(s+=7));var a=i+s,f=a;while(f>7)f-=7;a+=7-f;for(var l=0,c=0;l<a;l++){var p=new Date(e,t,1+(l-s)),m=n.minDate&&p<n.minDate||n.maxDate&&p>n.maxDate,g=h(this._d)?v(p,this._d):!1,y=v(p,r),E=l<s||l>=i+s;u.push(b(1+(l-s),g,y,m,E)),++c===7&&(o.push(w(u,n.isRTL)),u=[],c=0)}return T(n,o)},isVisible:function(){return this._v},show:function(){this._v||(this._o.bound&&s(t,"click",this._onClick),l(this.el,"is-hidden"),this._v=!0,this.draw(),typeof this._o.onOpen=="function"&&this._o.onOpen.call(this))},hide:function(){if(this._v===n||this._v)this._o.bound&&o(t,"click",this._onClick),this.el.style.cssText="",f(this.el,"is-hidden"),this._v=!1,typeof this._o.onClose=="function"&&this._o.onClose.call(this)},destroy:function(){this.hide(),o(this.el,"mousedown",this._onMouseDown,!0),o(this.el,"change",this._onChange),this._o.field&&(o(this._o.field,"change",this._onInputChange),this._o.bound&&(o(this._o.field,"click",this._onInputClick),o(this._o.field,"focus",this._onInputFocus),o(this._o.field,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}}})(window,window.document);